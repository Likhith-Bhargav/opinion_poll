# üöÄ Opinion Poll Platform - Deployment Guide

This guide provides step-by-step instructions for deploying the Opinion Poll Platform with backend on **Render** and frontend on **Vercel**.

## üìã Prerequisites

- GitHub account with repository access
- **Render account** (render.com) - for backend deployment
- **Vercel account** (vercel.com) - for frontend deployment
- Node.js and npm installed locally (for frontend)
- Python 3.9+ installed locally (for backend)

## üèóÔ∏è Backend Deployment (Render)

### Step 1: Prepare Backend for Deployment

The backend is configured with the following files:
- `render.yaml` - Render deployment configuration
- `requirements.txt` - Python dependencies with production packages
- `runtime.txt` - Python version specification
- `.env.example` - Environment variables template

### Step 2: Deploy to Render

1. **Connect Render to GitHub:**
   - Go to [render.com](https://render.com) and sign in
   - Click "New" ‚Üí "Web Service"
   - Connect your GitHub repository
   - Select the repository containing your backend code

2. **Configure Service:**
   - **Name:** `opinion-poll-backend` (or your preferred name)
   - **Runtime:** `Python 3`
   - **Build Command:** `pip install -r requirements.txt`
   - **Start Command:** `gunicorn --worker-class eventlet -w 1 -b 0.0.0.0:10000 app_flask:app`

3. **Set Environment Variables in Render:**
   Render will automatically generate some variables. You need to set:
   ```
   FLASK_ENV = production
   CORS_ORIGINS = https://your-frontend.vercel.app
   SOCKETIO_CORS_ORIGINS = https://your-frontend.vercel.app
   ```

4. **Deploy:**
   - Click "Create Web Service"
   - Render will automatically build and deploy your backend

### Step 3: Get Render Backend URL

After deployment, Render will provide your backend URL (e.g., `https://your-app.onrender.com`).

## üé® Frontend Deployment (Vercel)

### Step 1: Prepare Frontend for Deployment

The frontend is configured with:
- `vercel.json` - Vercel deployment configuration
- `.vercelignore` - Files to ignore during deployment
- Environment variables configured for production

### Step 2: Deploy to Vercel

1. **Install Vercel CLI:**
   ```bash
   npm install -g vercel
   ```

2. **Deploy Frontend:**
   ```bash
   # Navigate to frontend directory
   cd frontend

   # Deploy to Vercel
   vercel --prod
   ```

3. **Set Environment Variables in Vercel:**
   - Go to your Vercel project dashboard
   - Navigate to Settings ‚Üí Environment Variables
   - Add the following variables:
     ```
     REACT_APP_API_URL = https://your-backend.onrender.com/api
     REACT_APP_WS_URL = https://your-backend.onrender.com
     ```

## üîó Connection Configuration

### Backend CORS Configuration

The backend is configured to accept requests from your Vercel domain:

```python
# In app_flask.py
cors_origins = os.getenv('CORS_ORIGINS', 'http://localhost:3000').split(',')
CORS(app, origins=cors_origins)

socketio_cors_origins = os.getenv('SOCKETIO_CORS_ORIGINS', 'http://localhost:3000').split(',')
socketio = SocketIO(app, cors_allowed_origins=socketio_cors_origins)
```

### Frontend API Configuration

The frontend automatically uses environment variables:

```javascript
// In services/*.js
const API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:8000/api';
const wsUrl = process.env.REACT_APP_WS_URL || 'http://localhost:8000';
```

## üîß Environment Variables

### Render Backend Variables:
```
FLASK_ENV=production
CORS_ORIGINS=https://your-frontend.vercel.app
SOCKETIO_CORS_ORIGINS=https://your-frontend.vercel.app
DATABASE_URL=postgresql://... (provided by Render)
JWT_SECRET_KEY=... (auto-generated by Render)
PORT=10000 (set automatically by Render)
```

### Vercel Frontend Variables:
```
REACT_APP_API_URL=https://your-backend.onrender.com/api
REACT_APP_WS_URL=https://your-backend.onrender.com
```

## üöÄ Deployment Commands

### Quick Deploy (Manual):
```bash
# Backend to Render (via web dashboard)
# 1. Go to render.com
# 2. New ‚Üí Web Service
# 3. Connect GitHub repo
# 4. Configure service with settings above

# Frontend to Vercel
cd frontend && vercel --prod
```

### Manual Deploy:
```bash
# Frontend to Vercel
vercel login
cd frontend
vercel --prod
```

## üîç Testing the Deployment

1. **Check Backend Health:**
   ```bash
   curl https://your-backend.onrender.com/health
   ```

2. **Check Frontend:**
   - Visit your Vercel deployment URL
   - Try creating an account and poll

3. **Test WebSocket Connection:**
   - Open browser developer tools
   - Check console for WebSocket connection logs

## üõ†Ô∏è Troubleshooting

### Common Issues:

1. **CORS Errors:**
   - Ensure CORS_ORIGINS includes your Vercel domain
   - Check Render logs in dashboard

2. **WebSocket Connection Issues:**
   - Verify SOCKETIO_CORS_ORIGINS includes your Vercel domain
   - Check if Render WebSocket port is open

3. **Database Connection:**
   - Ensure DATABASE_URL is correctly set in Render
   - Check if PostgreSQL is provisioned in Render

4. **Build Errors:**
   - Check Render build logs in dashboard
   - Check Vercel deployment logs in dashboard

### Render Logs:
- Check deployment logs in Render dashboard
- Go to your service ‚Üí Logs

### Vercel Logs:
- Check deployment logs in Vercel dashboard
- Use `vercel logs [deployment-url]` for specific deployment

## üìù Production Checklist

- [ ] Backend deployed on Render
- [ ] Frontend deployed on Vercel
- [ ] Environment variables configured
- [ ] CORS origins updated for production domains
- [ ] Database connection working
- [ ] WebSocket connection working
- [ ] Authentication working
- [ ] Real-time updates working
- [ ] Mobile responsive

## üîÑ Updates and Redeployment

### Backend Updates:
```bash
git add .
git commit -m "Update backend"
git push origin main
# Render will automatically redeploy when you push to main
```

### Frontend Updates:
```bash
cd frontend
git add .
git commit -m "Update frontend"
git push origin main
vercel --prod
```

## üìû Support

If you encounter issues:
1. Check Render and Vercel deployment logs
2. Verify environment variables
3. Test CORS configuration
4. Ensure database connectivity

## üéØ Next Steps

After successful deployment:
1. Set up custom domains (optional)
2. Configure SSL certificates (automatic with Render/Vercel)
3. Set up monitoring and logging
4. Configure backup strategies
5. Set up CI/CD pipelines for automated deployments
